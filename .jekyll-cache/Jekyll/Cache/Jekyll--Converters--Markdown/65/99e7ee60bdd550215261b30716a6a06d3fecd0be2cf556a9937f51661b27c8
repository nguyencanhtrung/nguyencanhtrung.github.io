I"Õ~<h2 id="má»¥c-Ä‘Ã­ch">Má»¥c Ä‘Ã­ch</h2>

<ul>
  <li>Tá»•ng há»£p má»™t thiáº¿t káº¿ script-based vÃ  GUI-based</li>
  <li>Sá»­ dá»±ng Catapult Gantt Chart vÃ  Catapult Design Analyzer</li>
  <li>Setup vÃ  sá»­ dá»¥ng simulation</li>
</ul>

<h2 id="thiáº¿t-káº¿-vá»›i-gui">Thiáº¿t káº¿ vá»›i GUI</h2>

<p>Má»™t project sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n theo thá»© tá»± sau</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/2-480.webp" />
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/2-800.webp" />
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/2-1400.webp" />
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/01.blogs/221102_catapult_journey_2/2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/3-480.webp" />
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/3-800.webp" />
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/3-1400.webp" />
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/01.blogs/221102_catapult_journey_2/3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />

  </picture>

</figure>

    </div>
</div>

<p><b>1. ThÃªm input files</b></p>
<ul>
  <li>ThÃªm file testbench nhÆ°ng exclude khá»i quÃ¡ trÃ¬nh biÃªn dá»‹ch</li>
  <li>Chá»‰ cáº§n thÃªm cÃ¡c file <code class="language-plaintext highlighter-rouge">*.cpp</code>, file header <code class="language-plaintext highlighter-rouge">*.h</code> sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng thÃªm</li>
</ul>

<p><b>2. Cáº¥u hÃ¬nh hierarchy</b></p>
<ul>
  <li>Lá»±a chá»n <code class="language-plaintext highlighter-rouge">top-level</code> module Ä‘á»ƒ tool biÃªn dá»‹ch</li>
</ul>

<p><b>3. Cáº¥u hÃ¬nh library</b></p>
<ul>
  <li>Lá»±a chá»n devices, part number, cÃ´ng nghá»‡ vÃ  enable cÃ¡c thÆ° viÃªn vá» RAM, ROM â€¦ tÆ°Æ¡ng á»©ng cá»§a má»—i vendor</li>
</ul>

<p><b>4. Cáº¥u hÃ¬nh mapping</b></p>
<ul>
  <li>clocking, reset (asynchronous hay synchronous; active high or active low)</li>
</ul>

<p><b>5. Cáº¥u hÃ¬nh architecture</b></p>
<ul>
  <li>Interface/ IOs</li>
  <li>Memories</li>
  <li>Loops</li>
</ul>

<p>QuÃ¡ trÃ¬nh phÃ¡t triá»ƒn sáº½ sá»­ dá»¥ng cÃ¡c thÃ´ng tin tá»« <code class="language-plaintext highlighter-rouge">Gantt Chart</code> (cháº¡y tab <code class="language-plaintext highlighter-rouge">Schedule</code>) vÃ  <code class="language-plaintext highlighter-rouge">Design Analyzer</code> Ä‘á»ƒ quan sÃ¡t quÃ¡ trÃ¬nh chuyá»ƒn Ä‘á»•i tá»« high level model xuá»‘ng RTL model. Tá»« Ä‘Ã³, cÃ³ thá»ƒ lá»±a chá»n Ä‘Æ°á»£c thiáº¿t káº¿ tá»‘i Æ°u nháº¥t vá»›i yÃªu cáº§u Ä‘á» ra.</p>

<h2 id="thiáº¿t-káº¿-vá»›i-script">Thiáº¿t káº¿ vá»›i script</h2>

<p>Script-based thá»±c hiá»‡n Ä‘Ãºng theo quy trÃ¬nh cá»§a GUI-based á»Ÿ trÃªn. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Get current dir.</span>
<span class="nb">set </span>sfd <span class="o">[</span>file <span class="nb">dirname</span> <span class="o">[</span>info script]]

<span class="c"># Setup tool</span>
options defaults
options <span class="nb">set</span> /Input/CppStandard c++11

project new

flow package require /SCVerify
flow package option <span class="nb">set</span> /SCVerify/USE_CCS_BLOCK <span class="nb">true</span>

<span class="c"># 1. Read Design Files</span>
solution file add <span class="o">[</span>file <span class="nb">join</span> <span class="nv">$sfd</span> tb.cpp] <span class="nt">-type</span> C++ <span class="nt">-exclude</span> <span class="nb">true
</span>solution file add <span class="o">[</span>file <span class="nb">join</span> <span class="nv">$sfd</span> mult_add_pipeline_ref.cpp] <span class="nt">-type</span> C++ <span class="nt">-exclude</span> <span class="nb">true
</span>solution file add <span class="o">[</span>file <span class="nb">join</span> <span class="nv">$sfd</span> mult_add_pipeline.cpp] <span class="nt">-type</span> C++
go compile

<span class="c"># 2. Hierarchy</span>
<span class="c"># Design has only one module, tool will automatically detect the top-level </span>

<span class="c"># 3. Load Libraries</span>
solution library add nangate-45nm_beh <span class="nt">--</span> <span class="nt">-rtlsyntool</span> OasysRTL
go libraries

<span class="c"># 4. Mapping</span>
directive <span class="nb">set</span> <span class="nt">-CLOCKS</span> <span class="o">{</span>clk <span class="o">{</span><span class="nt">-CLOCK_PERIOD</span> 1.11 <span class="o">}}</span>
go assembly

<span class="c"># 5. Architecture </span>
<span class="c">#    Apply IO and Loop Constraints</span>
directive <span class="nb">set</span> /mult_add_pipeline/a:rsc <span class="nt">-MAP_TO_MODULE</span> ccs_ioport.ccs_in_wait
directive <span class="nb">set</span> /mult_add_pipeline/b:rsc <span class="nt">-MAP_TO_MODULE</span> ccs_ioport.ccs_in_wait
directive <span class="nb">set</span> /mult_add_pipeline/c:rsc <span class="nt">-MAP_TO_MODULE</span> ccs_ioport.ccs_in_wait
directive <span class="nb">set</span> /mult_add_pipeline/gain:rsc        <span class="nt">-MAP_TO_MODULE</span> ccs_ioport.ccs_in
directive <span class="nb">set</span> /mult_add_pipeline/gain_adjust:rsc <span class="nt">-MAP_TO_MODULE</span> ccs_ioport.ccs_in
directive <span class="nb">set</span> /mult_add_pipeline/result:rsc      <span class="nt">-MAP_TO_MODULE</span> ccs_ioport.ccs_out_wait

directive <span class="nb">set</span> /mult_add_pipeline/core/main <span class="nt">-PIPELINE_INIT_INTERVAL</span> 1
directive <span class="nb">set</span> /mult_add_pipeline/core/main <span class="nt">-PIPELINE_STALL_MODE</span> stall
directive <span class="nb">set</span> /mult_add_pipeline/core <span class="nt">-DESIGN_GOAL</span> area

<span class="c"># 6. Compile </span>
go extract
</code></pre></div></div>

<p>CÃ³ 2 cÃ¡ch khá»Ÿi cháº¡y script</p>

<p><strong><ins>Script-based</ins></strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catapult <span class="nt">-shell</span> <span class="nt">-file</span> script.tcl
</code></pre></div></div>

<p>Má»Ÿ <code class="language-plaintext highlighter-rouge">project</code> táº¡o ra tá»« script báº±ng cÃ¡ch</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catapult ./Catapult
</code></pre></div></div>

<p><strong><ins>GUI-based</ins></strong></p>

<p>Má»Ÿ Catapult,</p>

<p><code class="language-plaintext highlighter-rouge">File &gt; Run Script..</code></p>

<p>Trá» Ä‘áº¿n script.</p>

<h2 id="catapult-gantt-chart">Catapult Gantt Chart</h2>

<p>Cung cáº¥p thÃ´ng tin láº­p lá»‹ch cá»§a cÃ¡c operator. NgÆ°á»i thiáº¿t káº¿ cÃ³ thá»ƒ dá»±a vÃ o thÃ´ng tin nÃ y Ä‘á»ƒ tinh chá»‰nh viá»‡c láº­p lá»‹ch tá»« Ä‘Ã³ Ä‘áº¡t Ä‘Æ°á»£c cÃ¡c yÃªu cáº§u Ä‘Ã£ Ä‘áº·t ra.</p>

<p>ÄÃ¢y lÃ  má»™t chá»§ Ä‘á» nÃ¢ng cao, chÃºng ta sáº½ cÃ¹ng tÃ¬m hiá»ƒu vÃ  lÃ m rÃµ á»Ÿ cÃ¡c dá»± Ã¡n sáº¯p tá»›i.</p>

<h2 id="catapult-desing-analyzer">Catapult Desing Analyzer</h2>

<p>Cung cáº¥p thÃ´ng tin vÃ  cho phÃ©p cross-probed giá»¯a 3 model: C/C++ model, HDL model (Verilog/VHDL), RTL model (Schematic, Schedule).</p>

<p>Design Analyzer cung cáº¥p thÃ´ng tin chÃ­nh xÃ¡c vá» tÃ i nguyÃªn cá»§a tá»«ng khá»‘i tÆ°Æ¡ng á»©ng vá»›i cÃ¡c giai Ä‘oáº¡n cá»§a HLS tá»« <code class="language-plaintext highlighter-rouge">Compile</code> tá»›i <code class="language-plaintext highlighter-rouge">Extract</code></p>

<p>NgÆ°á»i thiáº¿t káº¿ cÃ³ thá»ƒ sá»­ dá»¥ng thÃ´ng tin nÃ y Ä‘á»ƒ kiá»ƒm tra cÃ¡c critical path trong thiáº¿t káº¿ tá»« Ä‘Ã³ cÃ³ nhá»¯ng giáº£i phÃ¡p tá»‘i Æ°u phÃ¹ há»£p.</p>

<h2 id="rtl-co-simulation">RTL co-simulation</h2>

<p>Äá»ƒ cÃ³ thá»ƒ mÃ´ phá»ng Ä‘Æ°á»£c nhiá»u trÆ°á»ng há»£p cÃ³ thá»ƒ xáº£y ra trong thá»±c táº¿, SCVerify cho phÃ©p ngÆ°á»i test chÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> vÃ o input vÃ  output Ä‘á»ƒ kiá»ƒm tra tráº¡ng thÃ¡i cá»§a há»‡ thá»‘ng trong cÃ¡c trÆ°á»ng há»£p Ä‘Ã³.</p>

<p><code class="language-plaintext highlighter-rouge">STALL</code> táº¡i input tÆ°Æ¡ng á»©ng vá»›i VALID = â€˜0â€™</p>

<p><code class="language-plaintext highlighter-rouge">STALL</code> táº¡i output tÆ°Æ¡ng á»©ng vá»›i READY = â€˜0â€™</p>

<p>ChÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> vÃ o input hoáº·c output bao gá»“m hai cÃ´ng Ä‘oáº¡n:</p>

<ul>
  <li>Viáº¿t C/C++ testbench Ä‘iá»u khiá»ƒn quÃ¡ trÃ¬nh chÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> vÃ o input vÃ  output</li>
  <li>Cáº¥u hÃ¬nh tool Compile tool Ä‘á»ƒ cho phÃ©p nháº­n flag <code class="language-plaintext highlighter-rouge">STALL</code> tá»« testbench</li>
</ul>

<p>HÃ£y cÃ¹ng tÃ¬m hiá»ƒu vÃ­ dá»¥ sau Ä‘Ã¢y Ä‘á»ƒ hiá»ƒu rÃµ hÆ¡n:</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include</span> <span class="cpf">"mult_add_pipeline.h"</span><span class="cp">
#include</span> <span class="cpf">"mult_add_pipeline_ref.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;mc_scverify.h&gt;</span><span class="cp">
</span>
<span class="n">CCS_MAIN</span><span class="p">(</span><span class="kt">int</span> <span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a_ref</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">b_ref</span><span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c_ref</span><span class="p">;</span>

  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">result_ref</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">errCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">11</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">14</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">25</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">ac_channel</span><span class="o">&lt;</span><span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">11</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">a_chan</span><span class="p">;</span>
  <span class="n">ac_channel</span><span class="o">&lt;</span><span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">14</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">b_chan</span><span class="p">;</span>
  <span class="n">ac_channel</span><span class="o">&lt;</span><span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">25</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">c_chan</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">gain_ref</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="n">ac_fixed</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="n">gain</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">gain_adjust</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="n">ac_channel</span><span class="o">&lt;</span><span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">30</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">result</span><span class="p">;</span>
  <span class="n">ac_int</span><span class="o">&lt;</span><span class="mi">30</span><span class="p">,</span><span class="nb">false</span><span class="o">&gt;</span> <span class="n">res</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
    <span class="n">a_ref</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
    <span class="n">b_ref</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">33554431</span><span class="p">;</span>
    <span class="n">c_ref</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
<span class="cp">#ifdef CCS_SCVERIFY
#ifdef STALL
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">testbench</span><span class="o">::</span><span class="n">a_wait_ctrl</span><span class="p">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">testbench</span><span class="o">::</span><span class="n">result_wait_ctrl</span><span class="p">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">#endif
#endif
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">gain_adjust</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">a_chan</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="n">b_chan</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
    <span class="n">c_chan</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">mult_add_pipeline_ref</span><span class="p">(</span><span class="n">a_ref</span><span class="p">,</span><span class="n">b_ref</span><span class="p">,</span><span class="n">c_ref</span><span class="p">,</span><span class="n">gain</span><span class="p">,</span><span class="n">gain_adjust</span><span class="p">,</span><span class="n">result_ref</span><span class="p">);</span>
    <span class="n">mult_add_pipeline</span><span class="p">(</span><span class="n">a_chan</span><span class="p">,</span><span class="n">b_chan</span><span class="p">,</span><span class="n">c_chan</span><span class="p">,</span><span class="n">gain</span><span class="p">,</span><span class="n">gain_adjust</span><span class="p">,</span><span class="n">result</span><span class="p">);</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result_ref</span> <span class="o">!=</span> <span class="n">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR MISMATCH iteration: %d a = %4d  b = %5d  result_ref = %08x  result_bit_acc = %08x </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">a_ref</span><span class="p">,</span><span class="n">b_ref</span><span class="p">,</span><span class="n">result_ref</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">to_uint</span><span class="p">());</span>
      <span class="n">errCnt</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"iteration: %2d a = %4d  b = %5d  result_ref = %08x  result_bit_acc = %08x </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">a_ref</span><span class="p">,</span><span class="n">b_ref</span><span class="p">,</span><span class="n">result_ref</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">to_uint</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">CCS_RETURN</span><span class="p">(</span><span class="n">errCnt</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>ÄÃ¢y lÃ  má»™t testbench, nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ kiá»ƒm tra tráº¡ng thÃ¡i cá»§a máº¡ch <code class="language-plaintext highlighter-rouge">mult_add_pipeline</code>. CÃ¡ch máº¡ch nÃ y hoáº¡t Ä‘á»™ng khÃ´ng quan trá»ng trong váº¥n Ä‘á» Ä‘ang tháº£o luáº­n á»Ÿ Ä‘Ã¢y. HÃ£y chÃº Ã½ vÃ o Ä‘oáº¡n code:</p>

<h3 id="chÃ¨n-stall-trong-testbench">ChÃ¨n STALL trong testbench</h3>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#ifdef CCS_SCVERIFY
#ifdef STALL
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">testbench</span><span class="o">::</span><span class="n">a_wait_ctrl</span><span class="p">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">testbench</span><span class="o">::</span><span class="n">result_wait_ctrl</span><span class="p">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">#endif
#endif</span></code></pre></figure>

<p>Äoáº¡n code nÃ y sáº½ thá»±c hiá»‡n bÃ¡o cho SCVERIFY thá»±c hiá»‡n chÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> vÃ o tÃ­n hiá»‡u input <code class="language-plaintext highlighter-rouge">a</code> khi <code class="language-plaintext highlighter-rouge">i = 3</code> vÃ  chÃ¨n vÃ o tÃ­n hiá»‡u output <code class="language-plaintext highlighter-rouge">result</code> khi <code class="language-plaintext highlighter-rouge">i = 7</code>. Má»—i má»™t <code class="language-plaintext highlighter-rouge">STALL</code> kÃ©o dÃ i 2 chu ká»³ clock.</p>

<p><strong><ins>ChÃº Ã½ quan trá»ng</ins></strong></p>

<p>Äá»ƒ cÃ³ thá»ƒ chÃ¨n Ä‘Æ°á»£c <code class="language-plaintext highlighter-rouge">STALL</code> thÃ¬ input vÃ  output pháº£i Ä‘Æ°á»£c constraint vá» dáº¡ng <code class="language-plaintext highlighter-rouge">ccs_io_*_wait</code> Ä‘á»ƒ Ä‘áº£m báº£o ngoÃ i <code class="language-plaintext highlighter-rouge">DATA</code>, tÃ­n hiá»‡u Ä‘Ã³ khi tá»•ng há»£p xuá»‘ng RTL cÃ³ Ä‘á»§ tÃ­n hiá»‡u <code class="language-plaintext highlighter-rouge">VALID</code> vÃ  <code class="language-plaintext highlighter-rouge">READY</code>.</p>

<p>ChÆ°a cÃ³ giáº£i phÃ¡p chÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> cho interface dáº¡ng <code class="language-plaintext highlighter-rouge">amba.ccs_axi4stream_in</code> hoáº·c <code class="language-plaintext highlighter-rouge">amba.ccs_axi4stream_out</code>. Xáº£y ra lá»—i nhÆ° sau:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
../../src/crc_tb.cpp: In member <span class="k">function</span> <span class="s1">'int testbench::main()'</span>:
Error: ../../src/crc_tb.cpp<span class="o">(</span>73<span class="o">)</span>: error: <span class="s1">'stream_in_wait_ctrl'</span> is not a member of <span class="s1">'testbench'</span>
           testbench::stream_in_wait_ctrl.cycles <span class="o">=</span> 20<span class="p">;</span>
                      ^~~~~~~~~~~~~~~~~~~
Error: ../../src/crc_tb.cpp<span class="o">(</span>76<span class="o">)</span>: error: <span class="s1">'stream_in_wait_ctrl'</span> is not a member of <span class="s1">'testbench'</span>
           testbench::stream_in_wait_ctrl.cycles <span class="o">=</span> 20<span class="p">;</span>
                      ^~~~~~~~~~~~~~~~~~~
</code></pre></div></div>

<p><strong><ins>Syntax</ins></strong></p>

<p>ChÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> cÃ³ Ä‘á»™ dÃ i <code class="language-plaintext highlighter-rouge">Y</code> chu ká»³ clock cho má»™t tÃ­n hiá»‡u báº¥t ká»³ <code class="language-plaintext highlighter-rouge">X</code> trong testbench.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#ifdef CCS_SCVERIFY
#ifdef STALL
</span>
    <span class="n">testbench</span><span class="o">::</span><span class="n">X_wait_ctrl</span><span class="p">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="n">Y</span><span class="p">;</span>

<span class="cp">#endif
#endif</span></code></pre></figure>

<h3 id="cáº¥u-hÃ¬nh-compiler-Ä‘á»ƒ-enable-stall">Cáº¥u hÃ¬nh Compiler Ä‘á»ƒ enable STALL</h3>

<p>Giai Ä‘oáº¡n thá»© 2 lÃ  cáº¥u hÃ¬nh compiler flag Ä‘á»ƒ tá»•ng há»£p Ä‘Æ°á»£c Ä‘oáº¡n code testbench trÃªn.</p>

<p>Vá»›i GUI, truy cáº­p <code class="language-plaintext highlighter-rouge">Tools &gt; Set options.. &gt; Input &gt; Compiler Flags</code></p>

<p>Äiá»n <code class="language-plaintext highlighter-rouge">-DSTALL</code></p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/1-480.webp" />
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/1-800.webp" />
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/1-1400.webp" />
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/01.blogs/221102_catapult_journey_2/1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />

  </picture>

</figure>

    </div>
</div>

<p>Vá»›i script-based, chÃ¨n <code class="language-plaintext highlighter-rouge">-args -DSTALL</code> khi thÃªm file testbench <code class="language-plaintext highlighter-rouge">tb.cpp</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>solution file add <span class="o">[</span>file <span class="nb">join</span> <span class="nv">$sfd</span> tb.cpp] <span class="nt">-type</span> C++ <span class="nt">-exclude</span> <span class="nb">true</span> <span class="nt">-args</span> <span class="nt">-DSTALL</span>
</code></pre></div></div>
<p>Sau Ä‘Ã³, recompile láº¡i thiáº¿t káº¿ (táº¡o branch hoáº·c solution má»›i Ä‘á»ƒ cháº¡y)</p>

<h3 id="tá»±-Ä‘á»™ng-chÃ¨n-stall-bá»Ÿi-scverify">Tá»± Ä‘á»™ng chÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> bá»Ÿi SCVerify</h3>

<p>Pháº§n trÃªn lÃ  hÆ°á»›ng dáº«n chÃ¨n <code class="language-plaintext highlighter-rouge">STALL</code> vÃ o input vÃ  output bá»Ÿi ngÆ°á»i thiáº¿t káº¿, SCVerify cho phÃ©p chÃ¨n STALL vÃ o
interface má»™t cÃ¡ch tá»± Ä‘á»™ng. Báº±ng cÃ¡ch truy cáº­p <code class="language-plaintext highlighter-rouge">Architecture &gt; "Top level module" &gt; Insert STALL flags</code></p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/4-480.webp" />
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/4-800.webp" />
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/4-1400.webp" />
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/01.blogs/221102_catapult_journey_2/4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />

  </picture>

</figure>

    </div>
</div>

<p>CÃ¡ch nÃ y há»‡ thá»‘ng khÃ´ng bá»‹ STALL á»Ÿ input hay output nhÆ° cÃ¡ch trÃªn, mÃ  Ä‘Æ°á»£c stall á»Ÿ <code class="language-plaintext highlighter-rouge">STALLER</code>, khÃ´ng cÃ³ Ã½ nghÄ©a nhiá»u trong viá»‡c test.</p>

<h2 id="pipeline-mode">Pipeline mode</h2>

<p>ChÃºng ta sáº½ tÃ¬m hiá»ƒu ká»¹ pháº§n nÃ y á»Ÿ nhá»¯ng pháº§n sau. á» Ä‘Ã¢y, tÃ´i chá»‰ muá»‘n giá»›i thiá»‡u thoÃ¡ng quÃ¡ vá» hiá»‡n tÆ°á»£ng Ä‘á»ƒ ngÆ°á»i thiáº¿t káº¿ chÃº Ã½ hÆ¡n.</p>

<p>á» trÆ°á»ng há»£p cá»§a tÃ´i, tÃ´i Ä‘Ã£ thiáº¿t káº¿ má»™t máº¡ch pipeline vá»›i II = 1 (Initial Interval = 1), tuy nhiÃªn khi cháº¡y trÃªn máº¡ch tháº­t, nÃ³ liÃªn tá»¥c bá»‹ treo vÃ  káº¿t quáº£ luÃ´n Ä‘Æ°á»£c nháº­n cháº­m hÆ¡n so vá»›i thÃ´ng sá»‘ thiáº¿t káº¿. Khi probe ILA hay Signal Tap, tÃ´i tháº¥y ráº±ng khi khÃ´ng cÃ³ input (VALID = â€˜0â€™), há»‡ thá»‘ng sáº½ <code class="language-plaintext highlighter-rouge">STALL</code> luÃ´n mÃ  khÃ´ng tiáº¿p tá»¥c tÃ­nh toÃ¡n Ä‘á»ƒ Ä‘Æ°a ra káº¿t quáº£, máº·c dÃ¹ Ä‘Ã£ cÃ³ Ä‘áº§y Ä‘á»§ Input.</p>

<p>Sau Ä‘Ã³ tÃ´i nháº­n ra ráº±ng, mÃ¬nh Ä‘Ã£ chÆ°a cáº¥u hÃ¬nh pipeline mode cho thiáº¿t káº¿. NÃ³ Ä‘Æ°á»£c cáº¥u hÃ¬nh máº·c Ä‘á»‹nh á»Ÿ <code class="language-plaintext highlighter-rouge">STALL</code> mode, nÃªn khi ko cÃ³ input (VALID = 0) hay output khÃ´ng sáºµn sÃ ng nháº­n dá»¯ liá»‡u (READY = 0), há»‡ thá»‘ng sáº½ bá»‹ STALL ngay láº­p tá»©c.</p>

<p>Tuy nhiÃªn, khi mÃ´ phá»ng co-simulation tÃ´i láº¡i khÃ´ng tháº¥y Ä‘Æ°á»£c hiá»‡n tÆ°á»£ng áº¥y. LÃ½ do lÃ  SCVerify liÃªn tá»¥c Ä‘áº©y dummy data Ä‘á»ƒ flush toÃ n bá»™ data trong pipeline chain sau má»—i láº§n cháº¡y nhÆ° trong hÃ¬nh.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/5-480.webp" />
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/5-800.webp" />
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/5-1400.webp" />
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/01.blogs/221102_catapult_journey_2/5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />

  </picture>

</figure>

    </div>
</div>

<p>DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch cáº¥u hÃ¬nh SCVerify Ä‘á»ƒ khÃ´ng tiáº¿p tá»¥c Ä‘áº©y dummy data.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>options <span class="nb">set </span>Flows/SCVerify/DISABLE_EMPTY_INPUTS <span class="nb">true
</span>flow run /SCVerify/regenerate rtl v rtl.v
flow run /SCVerify/regenerate rtl vhdl rtl.vhdl
flow run /SCVerify/regenerate rtl vhdl concat_sim_rtl.vhdl
flow run /SCVerify/regenerate rtl v concat_sim_rtl.v

</code></pre></div></div>
<p>ChÃº Ã½: 4 commands dÆ°á»›i Ä‘á»ƒ regenerate láº¡i makefile cho cáº£ 4 loáº¡i cosimulation (VHDL, concat-VHDL, Verilog, concat-Verilog). Báº¡n chá»‰ cáº§n dÃ¹ng má»™t loáº¡i trong Ä‘Ã³. Viá»‡c Regenerate Makefile lÃ  báº¯t buá»™c Ä‘á»ƒ Ä‘áº£m báº£o SCVerify cháº¡y chÃ­nh xÃ¡c.</p>

<p>Sau command trÃªn ta sáº½ tháº¥y káº¿ quáº£ nhÆ° sau:</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/6-480.webp" />
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/6-800.webp" />
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/6-1400.webp" />
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/01.blogs/221102_catapult_journey_2/6.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />

  </picture>

</figure>

    </div>
</div>

<p>Input Ä‘Ã£ Ä‘Æ°á»£c INVALID ngay khi khÃ´ng cÃ²n dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘Æ°a vÃ o.</p>

<p>Quay láº¡i váº¥n Ä‘á» trÃªn, viá»‡c cáº¥u hÃ¬nh trÃªn Ä‘áº£m báº£o viá»‡c mÃ´ phá»ng chÃ­nh xÃ¡c nhÆ° khi cháº¡y thá»±c táº¿, cÃ²n cÃ¡ch giáº£i quyáº¿t váº¥n Ä‘á» sáº½ lÃ : cáº¥u hÃ¬nh pipeline mode á»Ÿ dáº¡ng <code class="language-plaintext highlighter-rouge">Flush</code> hoáº·c <code class="language-plaintext highlighter-rouge">Bubble</code> Ä‘á»ƒ Catapult tá»± Ä‘á»™ng táº¡o controller kiá»ƒm soÃ¡t viá»‡c flushing dá»¯ liá»‡u khi Input invalid trong cÃ¡c kiáº¿n trÃºc pipeline. ChÃºng ta sáº½ phÃ¢n tÃ­ch chá»§ Ä‘á» nÃ y á»Ÿ má»™t bÃ i khÃ¡c.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/7-480.webp" />
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/7-800.webp" />
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/01.blogs/221102_catapult_journey_2/7-1400.webp" />
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/01.blogs/221102_catapult_journey_2/7.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />

  </picture>

</figure>

    </div>
</div>
:ET
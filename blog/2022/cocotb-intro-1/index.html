<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Cocotb framework - day 1 | Trung Canh Nguyen</title> <meta name="author" content="Trung Canh Nguyen"/> <meta name="description" content="Learning about cocotb framework for RTL simulation"/> <meta name="keywords" content="catapult, fpga, vhdl, hdl, intel, xilinx"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://bobibo.one/blog/2022/cocotb-intro-1/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <d-front-matter> <script async type="text/json">{
      "title": "Cocotb framework - day 1",
      "description": "Learning about cocotb framework for RTL simulation",
      "published": "October 19, 2022",
      "authors": [
        {
          "author": "Nguyen Canh Trung",
          "authorURL": "https://bobibo.one",
          "affiliations": [
            {
              "name": "bobibo.one",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <body class="fixed-top-nav"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Trung </span>Canh Nguyen</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Collections</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/blog/tag/core/">Fundamental</a> <a class="dropdown-item" href="/blog/tag/hdl/">HDL</a> <a class="dropdown-item" href="/blog/tag/hls/">HLS</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/blog/tag/catapult/">Catapult</a> <a class="dropdown-item" href="/blog/tag/intel/">Intel</a> <a class="dropdown-item" href="/blog/tag/xilinx/">Xilinx</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="post distill"> <d-title> <h1>Cocotb framework - day 1</h1> <p>Learning about cocotb framework for RTL simulation</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#overview">Overview</a></div> <div><a href="#installation">Installation</a></div> <ul> <li><a href="#python-installation">Python installation</a></li> <li><a href="#cocotb-packages-installation">Cocotb packages installation</a></li> <li><a href="#icarus-verilog-installation">Icarus Verilog installation</a></li> <li><a href="#questasim">Questasim</a></li> </ul> <div><a href="#my-hello-world-with-cocotb">My Hello World with cocotb</a></div> <div><a href="#cocotb-with-questasim">Cocotb with Questasim</a></div> </nav> </d-contents> <h2 id="overview">Overview</h2> <p>Want to learn</p> <ul> <li>Cocotb framework using python</li> <li>web development</li> <li>Telegram bot</li> <li>Trading bot</li> </ul> <h2 id="installation">Installation</h2> <p>The current stable version 1.7.1 of cocotb requires:</p> <ul> <li>Python 3.6+</li> <li>GNU Make 3+</li> <li>A Verilog or VHDL simulator, depending on your RTL source code</li> </ul> <h3 id="python-installation">Python installation</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>make python3 python3-pip
</code></pre></div></div> <p>We can use the global python installation for <code class="language-plaintext highlighter-rouge">cocotb</code>. However, the better way is to create a separated environment for <code class="language-plaintext highlighter-rouge">cocotb</code> to prevent any corruption on main python installation.</p> <p>Here, we create our own python env inside the <code class="language-plaintext highlighter-rouge">cocotb</code> working directory.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="nv">$PATH_TO_YOUR_COCOTB_WS</span>
python3 <span class="nt">-m</span> venv venv
</code></pre></div></div> <p>It creates the <code class="language-plaintext highlighter-rouge">venv</code> directory. Now, check the current environment</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>which python3
</code></pre></div></div> <p>You will notice that it still uses the global environment <code class="language-plaintext highlighter-rouge">usr/bin/python3</code></p> <p>Lets activate the working environment</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source </span>venv/bin/active
</code></pre></div></div> <p>Now, check the current environment</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>which python3
</code></pre></div></div> <p>New environment for cocotb is activated.</p> <h3 id="cocotb-packages-installation">Cocotb packages installation</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>cocotb pytest cocotb-bus cocotb-coverage
</code></pre></div></div> <p>Make sure <code class="language-plaintext highlighter-rouge">pip</code> version <code class="language-plaintext highlighter-rouge">3.x</code></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nt">-V</span>
</code></pre></div></div> <p>Otherwise, using <code class="language-plaintext highlighter-rouge">pip3</code> instead.</p> <p>The packages are installed in <code class="language-plaintext highlighter-rouge">venv/lib/python3.x/site-packages</code></p> <p>You may need to add to <code class="language-plaintext highlighter-rouge">PATH</code> and add this line into your <code class="language-plaintext highlighter-rouge">.bashrc</code> file</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/home/tesla/.local/bin:<span class="nv">$PATH</span>
</code></pre></div></div> <p>Checking whether it is successfull or not by typing <code class="language-plaintext highlighter-rouge">cocotb-config</code></p> <h3 id="icarus-verilog-installation">Icarus Verilog installation</h3> <p>Cocotb supports the following RTL simulators: Synopsys VCS, Intel Questa and Icarus Verilog. Icarus Verilog is free and can be obtained from <a href="https://github.com/steveicarus/iverilog" target="_blank" rel="noopener noreferrer">https://github.com/steveicarus/iverilog</a>. To install Icarus Verilog, follow the instructions from the git repository, or simply:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>iverilog
</code></pre></div></div> <p>Another way to install iverilog is to recompile and install from source code by following steps. I recommend this way to get the lastest version.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/steveicarus/iverilog
<span class="nb">cd </span>iverilog
sh ./autoconf.sh
./configure
make
<span class="nb">sudo </span>make <span class="nb">install</span>
</code></pre></div></div> <h3 id="questasim">Questasim</h3> <p>If using Questasim, just need to add the Questasim installation path</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">MODELSIM_BIN_DIR</span><span class="o">=</span><span class="s2">"/opt/Intel/questa_fe/bin"</span>
</code></pre></div></div> <p>Need to export the <code class="language-plaintext highlighter-rouge">LM_LICENSE_FILE</code> of Quartus package before running <code class="language-plaintext highlighter-rouge">cocotb</code></p> <p>Note that: the questasim here is Intel version. I have not make <code class="language-plaintext highlighter-rouge">cocotb</code> worked with <code class="language-plaintext highlighter-rouge">Mentor Questasim</code> yet.</p> <h2 id="my-hello-world-with-cocotb">My Hello World with cocotb</h2> <h3 id="makefile">Makefile</h3> <h3 id="important-concepts">Important concepts</h3> <ul> <li> <p>Use the <code class="language-plaintext highlighter-rouge">@cocotb.test()</code> decorator to mark the test function to be run.</p> </li> <li> <p>Use <code class="language-plaintext highlighter-rouge">.value = value</code> to assign a value to a signal.</p> </li> <li> <p>Use <code class="language-plaintext highlighter-rouge">.value</code> to get a signal’s current value.</p> </li> </ul> <p>============ Learning to write python testbenches</p> <p>Concurrent Execution</p> <ul> <li>Coroutines can be scheduled for concurrent execution with fork(), start(), and start_soon()</li> <li>Su khac nhau giua start() va start_soon() la gi</li> <li>fork() se bi loai bo</li> </ul> <h2 id="cocotb-with-questa">Cocotb with Questa</h2> <h3 id="enable-gui-and-waveform">Enable GUI and Waveform</h3> <p>Adding <code class="language-plaintext highlighter-rouge">GUI=1</code> and <code class="language-plaintext highlighter-rouge">WAVES=1</code> in the Makefiles. Or typing following command</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nv">GUI</span><span class="o">=</span>1 <span class="nv">WAVES</span><span class="o">=</span>1
</code></pre></div></div> <h3 id="gui-exits-after-simulation-done">GUI exits after simulation done</h3> <p><a href="https://github.com/cocotb/cocotb/issues/3046" target="_blank" rel="noopener noreferrer">Reference</a></p> <p>Switching from GUI=0 to GUI=1 and vice versa requires cleaning sim_build folder by</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="nv">$PATH_TO_TEST_DIR</span>
make clean

make <span class="nv">GUI</span><span class="o">=</span>1
</code></pre></div></div> <p>Reason: For Questa, runsim.do file is generated based on the value of the GUI parameter. But if the file has been generated once, its contents is not updated unless one deletes the file. <a href="URL">https://github.com/cocotb/cocotb/issues/2734</a></p> <h3 id="script_file">SCRIPT_FILE</h3> <p>For Questa/Modelsim, the SCRIPT_FILE is currently run before the simulation is initialized using the vsim command. In the common case where SCRIPT_FILE=wave.do, a file that sets up traces in the GUI, these traces fail to initialize since the underlying signals don’t exist yet.</p> <p>This commit runs the SCRIPT_FILE before the vsim command, allowing traces to be set up properly.</p> <h3 id="adding-different-libraries-in-questa">Adding different libraries in Questa</h3> <p><a href="https://github.com/cocotb/cocotb/issues/2785" target="_blank" rel="noopener noreferrer">URL</a></p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Trung Canh Nguyen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Last updated: November 09, 2023. </div> </footer> <d-bibliography src="/assets/bibliography/2018-12-22-distill.bib"></d-bibliography> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> </body> </html>